(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["tn_components/sign"],{"3f18":function(t,e,i){"use strict";(function(t){i("6847");n(i("66fd"));var e=n(i("a837"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},"514c":function(t,e,i){},"5f05":function(t,e,i){"use strict";i.r(e);var n=i("c2fe"),a=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},"8f11":function(t,e,i){"use strict";var n,a=function(){var t=this,e=t.$createElement;t._self._c},s=[];i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}))},"914a":function(t,e,i){"use strict";var n=i("514c"),a=i.n(n);a.a},a837:function(t,e,i){"use strict";i.r(e);var n=i("8f11"),a=i("5f05");for(var s in a)"default"!==s&&function(t){i.d(e,t,(function(){return a[t]}))}(s);i("914a");var c,r=i("f0c5"),o=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],c);e["default"]=o.exports},c2fe:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{canvasName:"handWriting",ctx:"",canvasWidth:0,canvasHeight:0,transparent:1,selectColor:"black",lineColor:"#1A1A1A",lineSize:1.5,lineMin:.5,lineMax:4,pressure:1,smoothness:60,currentPoint:{},currentLine:[],firstTouch:!0,radius:1,cutArea:{top:0,right:0,bottom:0,left:0},bethelPoint:[],lastPoint:0,chirography:[],currentChirography:{},linePrack:[]}},onLoad:function(){var t=this,e=this.canvasName,i=wx.createCanvasContext(e);this.ctx=i;var n=wx.createSelectorQuery();n.select(".handCenter").boundingClientRect((function(e){t.canvasWidth=e.width,t.canvasHeight=e.height,t.setCanvasBg("#fff")})).exec()},methods:{uploadScaleStart:function(t){if("touchstart"!=t.type)return!1;var e=this.ctx;e.setFillStyle(this.lineColor),e.setGlobalAlpha(this.transparent);var i={x:t.touches[0].x,y:t.touches[0].y},n=this.currentLine;n.unshift({time:(new Date).getTime(),dis:0,x:i.x,y:i.y}),this.currentPoint=i,this.firstTouch&&(this.cutArea={top:i.y,right:i.x,bottom:i.y,left:i.x},this.firstTouch=!1),this.pointToLine(n)},uploadScaleMove:function(t){if("touchmove"!=t.type)return!1;t.cancelable&&(t.defaultPrevented||t.preventDefault());var e={x:t.touches[0].x,y:t.touches[0].y};e.y<this.cutArea.top&&(this.cutArea.top=e.y),e.y<0&&(this.cutArea.top=0),e.x>this.cutArea.right&&(this.cutArea.right=e.x),this.canvasWidth-e.x<=0&&(this.cutArea.right=this.canvasWidth),e.y>this.cutArea.bottom&&(this.cutArea.bottom=e.y),this.canvasHeight-e.y<=0&&(this.cutArea.bottom=this.canvasHeight),e.x<this.cutArea.left&&(this.cutArea.left=e.x),e.x<0&&(this.cutArea.left=0),this.lastPoint=this.currentPoint,this.currentPoint=e;var i=this.currentLine;i.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint),x:e.x,y:e.y}),this.pointToLine(i)},uploadScaleEnd:function(t){if("touchend"!=t.type)return 0;var e={x:t.changedTouches[0].x,y:t.changedTouches[0].y};this.lastPoint=this.currentPoint,this.currentPoint=e;var i=this.currentLine;if(i.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint),x:e.x,y:e.y}),i.length>2)i[0].time,i[i.length-1].time,i.length;this.pointToLine(i);var n={lineSize:this.lineSize,lineColor:this.lineColor},a=this.chirography;a.unshift(n),this.chirography=a;var s=this.linePrack;s.unshift(this.currentLine),this.linePrack=s,this.currentLine=[]},retDraw:function(){this.ctx.clearRect(0,0,700,730),this.ctx.draw(),this.setCanvasBg("#fff")},pointToLine:function(t){this.calcBethelLine(t)},calcBethelLine:function(t){if(t.length<=1)t[0].r=this.radius;else{var e,i,n,a,s,c,r,o,h,u,l=0,f=0,x=.5;t.length<=2?(e=t[1].x,a=t[1].y,n=t[1].x+(t[0].x-t[1].x)*x,c=t[1].y+(t[0].y-t[1].y)*x,i=e+(n-e)*x,s=a+(c-a)*x):(e=t[2].x+(t[1].x-t[2].x)*x,a=t[2].y+(t[1].y-t[2].y)*x,i=t[1].x,s=t[1].y,n=i+(t[0].x-i)*x,c=s+(t[0].y-s)*x),h=this.distance({x:n,y:c},{x:e,y:a}),u=this.radius;for(var y=0;y<t.length-1;y++)if(l+=t[y].dis,f+=t[y].time-t[y+1].time,l>this.smoothness)break;this.radius=Math.min(f/h*this.pressure+this.lineMin,this.lineMax)*this.lineSize,t[0].r=this.radius,t.length<=2?(r=(u+this.radius)/2,o=r,o):(r=(t[2].r+t[1].r)/2,o=t[1].r,(t[1].r+t[0].r)/2);for(var d=5,v=[],p=0;p<d;p++){var m=p/(d-1),g=(1-m)*(1-m)*e+2*m*(1-m)*i+m*m*n,w=(1-m)*(1-m)*a+2*m*(1-m)*s+m*m*c,P=u+(this.radius-u)/d*p;if(v.push({x:g,y:w,r:P}),3==v.length){var T=this.ctaCalc(v[0].x,v[0].y,v[0].r,v[1].x,v[1].y,v[1].r,v[2].x,v[2].y,v[2].r);T[0].color=this.lineColor,this.bethelDraw(T,1),v=[{x:g,y:w,r:P}]}}this.currentLine=t}},distance:function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},ctaCalc:function(t,e,i,n,a,s,c,r,o){var h,u,l,f,x,y,d,v,p,m=[];h=n-t,u=a-e,l=2*Math.sqrt(h*h+u*u+1e-4),h=h/l*i,u=u/l*i,f=u,x=-h,y=n-c,d=a-r,l=2*Math.sqrt(y*y+d*d+1e-4),y=y/l*o,d=d/l*o,v=-d,p=y,m.push({mx:t+f,my:e+x,color:"#1A1A1A"}),m.push({c1x:n+f,c1y:a+x,c2x:n+v,c2y:a+p,ex:c+v,ey:r+p}),m.push({c1x:c+v-y,c1y:r+p-d,c2x:c-v-y,c2y:r-p-d,ex:c-v,ey:r-p}),m.push({c1x:n-v,c1y:a-p,c2x:n-f,c2y:a-x,ex:t-f,ey:e-x}),m.push({c1x:t-f-h,c1y:e-x-u,c2x:t+f-h,c2y:e+x-u,ex:t+f,ey:e+x}),m[0].mx=m[0].mx.toFixed(1),m[0].mx=parseFloat(m[0].mx),m[0].my=m[0].my.toFixed(1),m[0].my=parseFloat(m[0].my);for(var g=1;g<m.length;g++)m[g].c1x=m[g].c1x.toFixed(1),m[g].c1x=parseFloat(m[g].c1x),m[g].c1y=m[g].c1y.toFixed(1),m[g].c1y=parseFloat(m[g].c1y),m[g].c2x=m[g].c2x.toFixed(1),m[g].c2x=parseFloat(m[g].c2x),m[g].c2y=m[g].c2y.toFixed(1),m[g].c2y=parseFloat(m[g].c2y),m[g].ex=m[g].ex.toFixed(1),m[g].ex=parseFloat(m[g].ex),m[g].ey=m[g].ey.toFixed(1),m[g].ey=parseFloat(m[g].ey);return m},bethelDraw:function(t,e,i){var n=this.ctx;n.beginPath(),n.moveTo(t[0].mx,t[0].my),void 0!=i?(n.setFillStyle(i),n.setStrokeStyle(i)):(n.setFillStyle(t[0].color),n.setStrokeStyle(t[0].color));for(var a=1;a<t.length;a++)n.bezierCurveTo(t[a].c1x,t[a].c1y,t[a].c2x,t[a].c2y,t[a].ex,t[a].ey);n.stroke(),void 0!=e&&n.fill(),n.draw(!0)},selectColorEvent:function(t,e){this.selectColor=t,this.lineColor=e},canvasToImg:function(t){this.ctx.draw(!0,(function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(e){wx.showToast({title:"执行了吗？"}),t(e.tempFilePath)}})}))},subCanvas:function(){this.ctx.draw(!0,(function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(t){wx.showToast({title:"以保存"}),wx.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(t){wx.showToast({title:"已成功保存到相册",duration:2e3})}})}})}))},saveCanvasAsImg:function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(t){wx.saveImageToPhotosAlbum({filePath:t.tempFilePath,success:function(t){wx.showToast({title:"已保存到相册",duration:2e3})}})}})},previewCanvasImg:function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"jpg",quality:1,success:function(t){wx.previewImage({urls:[t.tempFilePath]})}})},uploadCanvasImg:function(){wx.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(t){wx.uploadFile({url:"https://example.weixin.qq.com/upload",filePath:t.tempFilePath,name:"file_signature",formData:{user:"test"},success:function(t){t.data}})}})},setCanvasBg:function(t){this.ctx.rect(0,0,this.canvasWidth,this.canvasHeight-4),this.ctx.setFillStyle(t),this.ctx.fill(),this.ctx.draw()}}};e.default=n}},[["3f18","common/runtime","common/vendor"]]]);